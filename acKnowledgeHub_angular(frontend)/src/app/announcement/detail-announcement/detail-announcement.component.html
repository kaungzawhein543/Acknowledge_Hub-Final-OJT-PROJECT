<!-- Container -->
<div class="container bg-gray-100 w-full h-fit min-h-full p-6 pt-4 rounded-md">
  <div class="lg:w-9/12 md:w-10/12 sm:w-full flex mx-auto flex-col border-b border-gray-300">
    <!-- Header Section -->
    <div class="relative bg-gradient-to-r from-blue-800 to-blue-900 text-white p-6 rounded-t-lg flex justify-between items-center shadow-lg">
      <span class="text-3xl font-extrabold tracking-wide font-poppins drop-shadow-md">Detail Announcement</span>
      <div class="text-right">
        <span class="block text-base font-medium opacity-75">Created by:</span>
        <span class="block text-xl font-semibold">John Doe</span>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex flex-col bg-white p-6 rounded-b-lg shadow-lg space-y-6">
      <!-- Date and Category Section -->
      <div class="flex flex-col lg:flex-row justify-between items-center mb-6 border-b pb-4 border-gray-200">
        <div class="text-center lg:text-right">
          <i class="fas fa-calendar-alt text-gray-500"></i>
          <span class="text-md font-medium"> {{ announcement.createdAt | date: 'medium' }}</span>
        </div>
        <div class="text-center lg:text-left mt-3 lg:mt-0">
          <span class="text-lg font-medium text-gray-800 me-2">Category: Training Sessions</span>
          <button *ngIf="this.currentUserId === this.createdStaff" class="bg-white border-2 border-blue-300 hover:bg-blue-600 hover:text-white text-blue-500 py-2 px-3 rounded-md " [routerLink]="['/announcement/update/',this.announcement.id]">
            <i class="fas fa-edit icon"></i>
            <span class="edit-text">Edit</span>
          </button>
        </div>
      </div>

      <!-- Title Section -->
      <div class="text-center">
        <p class="text-2xl font-semibold text-gray-900 uppercase">{{ announcement.title }}</p>
      </div>

      <!-- Description Section -->
      <div class="text-justify space-y-4">
        <p class="text-lg tracking-wide text-gray-700">{{ announcement.description }}</p>
        <div class="flex items-center text-gray-700">
          <i class="fas fa-file-alt mr-2"></i>
          <span class="text-base">Attached File: <a  class="text-blue-600 underline" (click)="downloadFile(this.announcement.file)">Download</a></span>
        </div>
      </div>

      <!-- Action Buttons for Announcement -->
      <div class="flex justify-between">
        <div class="flex flex-col space-y-3">
          <div class="p-2 border border-gray-200">
            <span *ngIf="noted" ><i class="fas fa-check-to-slot"></i>You Already Noted This Annnouncement!</span>
            <button *ngIf="!noted" class="bg-indigo-600 p-3 rounded-md hover:bg-indigo-700 text-white" (click)="notedAnnouncement(currentUserId,announcement.id)"><i class="fas fa-exclamation-triangle me-1"> </i>Noted Here</button>
          </div>
          <div class="text-sm text-gray-600 flex space-x-4" *ngIf="this.currentUserId === this.createdStaff || isAdmin">
            <span class="flex items-center space-x-1">
              <i class="fas fa-check-circle text-green-500"></i>
              <span>Noted: {{this.notedCount}}</span>
            </span>
            <span class="flex items-center space-x-1">
              <i class="fas fa-times-circle text-red-500"></i>
              <span>Unnoted: {{this.unNotedCount}}</span>
            </span>
          </div>
        </div>
        <button (click)="openQAModal()" class="bg-blue-700 text-white py-2 px-4 rounded max-h-12 hover:bg-blue-600">
          <i class="fa-solid fa-circle-question"></i> View Q&A
        </button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isQAModalOpen" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white relative w-11/12 md:w-3/4 lg:w-1/2 p-6 rounded-lg shadow-lg min-h-[650px]">
    <div class="flex justify-between items-center mb-4 border-b pb-4 border-gray-200">
      <span class="text-2xl font-semibold text-gray-900">Q&A</span>
      <button (click)="closeQAModal()" class="text-gray-500 hover:text-gray-700">
        <i class="fas fa-times text-xl rounded-lg p-2 px-3 hover:bg-gray-200"></i>
      </button>
    </div>

    <!-- Display Q&A and Replies -->
    <div class="space-y-4 max-h-80 overflow-y-auto pb-24"> <!-- Add padding-bottom -->
      <div *ngFor="let question of questionList; let i = index" class="bg-gray-100 p-4 rounded-lg shadow-md">
        <div class="flex justify-between items-center text-sm">
          <span class="font-semibold text-gray-800">{{ question.staffName }}</span>
          <span class="text-xs text-gray-500">{{ question.createdAt | date:'short' }}</span>
        </div>
        <p class="text-gray-700 mt-1 text-base">{{ question.content }}</p>
        <!-- Reply Form -->
        <div class="mt-3" *ngIf="replyPermission && question.replyBy == null">
          <button (click)="toggleReplyForm(question.feedbackId)" class="text-blue-600 text-sm hover:underline focus:outline-none">Reply</button>
          <div *ngIf="replyFormsVisible[question.feedbackId]" class="mt-3">
            <textarea [(ngModel)]="question.replyText" name="reply" class="w-full p-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" rows="2" placeholder="Write a reply..."></textarea>
            <button (click)="sendReply(question, i)" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-3 rounded-md mt-2 text-sm">Submit</button>
          </div>
        </div>
        <!-- Replies -->
        <div *ngIf="question.replyBy != null && question.content != null" class="mt-3 ml-4 bg-white rounded-md p-2">
          <div class="flex justify-between  items-center text-xs">
            <span class="font-medium text-gray-700">{{ question.replyBy }}</span>
            <span class="text-xs text-gray-500">{{ question.replyAt | date:'short' }}</span>
          </div>
          <p class="text-gray-700 mt-1 text-sm">{{ question.reply }}</p>
        </div>
      </div>
    </div>

    <div *ngIf="questionList.length === 0" class="flex items-center justify-center">
      <i class="fa-solid fa-triangle-exclamation text-gray-400"></i>  <span class="text-md font-normal text-gray-400">There is no question about this announcement</span>
    </div>

    <!-- Fixed Q&A Form at Bottom -->
    <div class="absolute bottom-0 left-0 w-full bg-white border-t pt-4 px-6 pb-4 rounded-b-lg"> <!-- Added rounded-b-lg -->
      <span class="block text-lg font-semibold text-gray-800 mb-2">Ask a Question:</span>
      <form #announcementForm="ngForm" (ngSubmit)="onSubmit(announcementForm)">
        <div class="mb-3">
          <label for="question" class="block text-sm font-medium text-gray-700">Your Question:</label>
          <textarea id="question" [(ngModel)]="feedback.content" name="question" class="w-full mt-1 p-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Ask Your Question Here"></textarea>
        </div>
        <div class="flex justify-end">
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-300">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>
